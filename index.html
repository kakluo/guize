<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通知车主挪车</title>
    <link rel="icon" href="${siteIconUrl}" type="image/x-icon">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
       
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        background-color: #f8f9fa;
        color: #333;
      }
       
      .container {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
       
      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 24px;
      }
       
      .message-area {
        margin-bottom: 20px;
      }
       
      textarea {
        width: 100%;
        height: 120px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        resize: none;
        font-size: 16px;
        margin-bottom: 5px;
      }
       
      .char-count {
        text-align: right;
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
      }
       
      .templates {
        margin-bottom: 20px;
      }
       
      .template-btn {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 8px 15px;
        margin: 0 5px 5px 0;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }
       
      .template-btn:hover {
        background: #e9ecef;
      }
       
      .action-buttons {
        display: flex;
        gap: 10px;
      }
       
      .btn {
        flex: 1;
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
      }
       
      .notify-btn {
        background: #007bff;
        color: white;
      }
       
      .notify-btn:hover {
        background: #0056b3;
      }
       
      .notify-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }
       
      .call-btn {
        background: #28a745;
        color: white;
      }
       
      .call-btn:hover {
        background: #218838;
      }
       
      /* 模态框样式 */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1000;
      }
       
      .modal-content {
        position: relative;
        background-color: white;
        margin: 20% auto;
        padding: 20px;
        width: 90%;
        max-width: 400px;
        border-radius: 10px;
        text-align: center;
      }
       
      .modal-title {
        margin-bottom: 15px;
        font-size: 18px;
        color: #2c3e50;
      }
       
      .modal-phone {
        font-size: 24px;
        color: #007bff;
        margin-bottom: 20px;
      }
       
      .modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
      }
       
      .modal-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
      }
       
      .confirm-btn {
        background: #28a745;
        color: white;
      }
       
      .confirm-btn:hover {
        background: #218838;
      }
       
      .cancel-btn {
        background: #dc3545;
        color: white;
      }
       
      .cancel-btn:hover {
        background: #c82333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>通知车主挪车</h1>
       
      <div class="message-area">
        <textarea id="messageInput" placeholder="请输入通知内容"></textarea>
        <div id="charCount" class="char-count">0/200</div>
      </div>
       
      <div class="templates">
        <button class="template-btn">默认</button>
        <button class="template-btn">礼貌</button>
        <button class="template-btn">紧急</button>
        <button class="template-btn">关窗提示</button>
      </div>
       
      <div class="action-buttons">
        <button id="notifyBtn" class="btn notify-btn">发送通知</button>
        <button class="btn call-btn">拨打电话</button>
      </div>
    </div>
 
    <!-- 拨打电话确认模态框 -->
    <div id="callModal" class="modal">
      <div class="modal-content">
        <h2 class="modal-title">确认拨打车主电话？</h2>
        <div id="modalPhoneNumber" class="modal-phone"></div>
        <div class="modal-buttons">
          <button class="modal-btn confirm-btn">确认拨打</button>
          <button class="modal-btn cancel-btn">取消</button>
        </div>
      </div>
    </div>
 
    <script>
      // 在脚本开始处定义全局变量
      const phoneNumber = '13800138000';
      const webhookUrl = 'https://open.feishu.cn/open-apis/bot/v2/hook/***********';
 
      // 使用模板消息
      function useTemplate(template) {
        const messageInput = document.getElementById('messageInput');
        messageInput.value = template;
        updateCharCount();
      }
 
      // 更新字符计数
      function updateCharCount() {
        const messageInput = document.getElementById('messageInput');
        const charCount = document.getElementById('charCount');
        const notifyBtn = document.getElementById('notifyBtn');
        const currentLength = messageInput.value.length;
         
        charCount.textContent = currentLength + '/200';
         
        // 启用/禁用发送按钮
        notifyBtn.disabled = currentLength === 0 || currentLength > 200;
         
        // 改变字符计数颜色
        if (currentLength > 200) {
          charCount.style.color = '#dc3545';
        } else {
          charCount.style.color = '#666';
        }
      }
 
      // 格式化电话号码显示
      function formatPhoneNumber(phone) {
        return phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
      }
 
      // 调用飞书 Webhook 发送通知
      function notifyOwner() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();
         
        if (!message) {
          alert('请输入通知内容');
          return;
        }
         
        if (message.length > 200) {
          alert('通知内容不能超过200字');
          return;
        }
 
        const notifyBtn = document.getElementById('notifyBtn');
        notifyBtn.disabled = true;
        notifyBtn.textContent = '发送中...';
 
        fetch(webhookUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            "msg_type": "text",
            "content": {
              "text": message
            }
          })
        })
        .then(response => response.json())
        .then(data => {
          console.log("通知发送成功", data);
          notifyBtn.textContent = '发送成功';
          messageInput.value = ''; // 清空输入框
          updateCharCount(); // 更新字符计数
          setTimeout(() => { 
            notifyBtn.textContent = '发送通知'; 
            notifyBtn.disabled = false; 
          }, 2000);
        })
        .catch(error => {
          console.error("发送通知失败", error);
          notifyBtn.textContent = '发送失败';
          setTimeout(() => { 
            notifyBtn.textContent = '发送通知'; 
            notifyBtn.disabled = false; 
          }, 2000);
        });
      }
 
      // 显示拨打电话的确认框
      function showCallModal() {
        const formattedNumber = formatPhoneNumber(phoneNumber);
        document.getElementById('modalPhoneNumber').textContent = formattedNumber;
        document.getElementById('callModal').style.display = 'block';
      }
 
      // 隐藏拨打电话的确认框
      function hideCallModal() {
        document.getElementById('callModal').style.display = 'none';
      }
 
      // 拨打车主电话
      function callOwner() {
        window.location.href = `tel:13800138000`;
        hideCallModal();
      }
 
      // 页面加载完成后初始化
      document.addEventListener('DOMContentLoaded', () => {
        useTemplate('您好，有人需要您挪车，请及时处理。');
      });
 
      // 点击模态框外部关闭模态框
      window.onclick = function(event) {
        const modal = document.getElementById('callModal');
        if (event.target === modal) {
          hideCallModal();
        }
      }
    </script>
  </body>
</html>
